about_PSql_Deploy
=================

SHORT DESCRIPTION

PSql.Deploy is a migration and seeding system for SQL Server and Azure SQL
Database.


LONG DESCRIPTION

The PSql.Deploy module provides cmdlets to deal with two core concepts:
migrations and seeds.  A migration is a SQL script that modifies the schema of
a target database.  A seed is a SQL script that populates a target database
with data.  Together, migrations and seeds provide a mechanism to perform
database deployments in a controlled and repeatable manner.

Source Directory Structure

PSql.Deploy expects migrations and seeds to have a specific filesystem layout.

src\                    The source directory: a set of migrations and
 │                        seeds for one database design.  The name can vary.
 │
 ├─ Migrations\         Migrations.  Required only if there are any migrations.
 │   │
 │   ├─ 0001\           One migration.  The name can vary.
 │   │   │
 │   │   ├─ _Main.sql   Top-level script for the migration.  It can
 │   │   │                include other files with the :r directive.
 │   │   ├─ FileA.sql   Example file included by _Main.sql.
 │   │   ├─ FileB.sql   Example file included by _Main.sql.
 │   │   └─ ...         More files, subdirectories, etc.
 │   │
 │   └─ ...             More migrations.
 │
 ├─ Seeds\              Seeds.  Required only if there are any seeds.
 │   │
 │   ├─ TestData\       One seed.  The name can vary.
 │   │   │
 │   │   ├─ _Main.sql   Top-level script for the seed.  It can
 │   │   │                include other files with the :r directive.
 │   │   ├─ FileA.sql   Example file included by _Main.sql.
 │   │   ├─ FileB.sql   Example file included by _Main.sql.
 │   │   └─ ...         More files, subdirectories, etc.
 │   │
 │   └─ ...             More seeds.
 │
 └─ ...                 PSql.Deploy does not care about other files or
                          directories present in the source directory.

See the sections below for more details about migrations and seeds.

TODO: SQLCMD mode support.
GO
    Breaks the script into batches.

$(name)
    Replaced by the value of the variable 'name' in the migration or seed.

:r <file>
    Include the contents of the specified file in the migration.  The variable
    $(Path) is available in the included file and expands to the path of the
    migration or seed file that includes the file.

:setvar <name> <value>
    Set a variable for the duration of the migration or seed.  The variable
    $(name) is available in the included file and expands to the value set by
    this directive.

TODO: General magic comments description.


Target Parameter
----------------

Most PSql.Deploy cmdlets accept a -Target parameter to specify one or more
target databases on which to operate.

TODO: Expand
